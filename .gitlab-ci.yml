stages:
  - build
  - test
  - deploy

image: docker:19.03.12
services:
  - docker:19.03.12-dind

build_backend:
  stage: build
  before_script:
    - docker info
    - docker -v
  script:
    - docker build ./backend -t backend

build_frontend:
  stage: build
  script:
    - echo "Here will go building frontend script"

test_backend_django_tests:
  stage: test
  needs:
    - job: build_backend
    artifacts: true
  script:
    - docker run backend python manage.py test

test_backend_django_pytest:
  stage: test
  needs:
    - job: build_backend
    artifacts: true
  script:
    - docker run backend pytest

test_frontend:
  stage: test
  needs: [build_frontend]
  script:
    - echo "Testing fronted script will go here!"

deploy_backend:
  stage: deploy
  needs:
    - test_backend_django_pytest
    - test_backend_django_tests
  script:
    - echo "Deploy backend script goes here."

deploy_fronted:
  stage: deploy
  needs:
    - test_frontend
  script:
    - echo "Deploy frontend script goes here."
